<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>æ¸ é“æœè´¦å·ç®¡ç†</title>
    <link rel="icon"
        href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+P+/HgAFdwI2QOQjeQAAAABJRU5ErkJggg==">


    <!-- èµ„æºä¼˜å…ˆä» s4.zstatic.net åŠ è½½ï¼Œå¤±è´¥å›é€€åˆ° cloudflare -->
    <script>
        (function () {
            const primary = {
                js: [
                    { src: 'https://s4.zstatic.net/ajax/libs/sweetalert/2.1.2/sweetalert.min.js', integrity: 'sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA==' },
                    { src: 'https://s4.zstatic.net/ajax/libs/bootstrap/5.3.8/js/bootstrap.min.js', integrity: 'sha512-nKXmKvJyiGQy343jatQlzDprflyB5c+tKCzGP3Uq67v+lmzfnZUi/ZT+fc6ITZfSC5HhaBKUIvr/nTLCV+7F+Q==' }
                ],
                css: [
                    { href: 'https://s4.zstatic.net/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css', integrity: 'sha512-2bBQCjcnw658Lho4nlXJcc6WkV/UxpE/sAokbXPxQNGqmNdQrWqtw26Ns9kFF/yG792pKR1Sx8/Y1Lf1XN4GKA==' },
                    { href: 'https://s4.zstatic.net/ajax/libs/bootstrap-icons/1.13.1/font/bootstrap-icons.min.css', integrity: 'sha512-t7Few9xlddEmgd3oKZQahkNI4dS6l80+eGEzFQiqtyVYdvcSG2D3Iub77R20BdotfRPA9caaRkg1tyaJiPmO0g==' }
                ]
            };

            const fallback = {
                js: [
                    { src: 'https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js', integrity: 'sha512-AA1Bzp5Q0K1KanKKmvN/4d3IRKVlv9PYgwFPvm32nPO6QS8yH1HO7LbgB1pgiOxPtfeg5zEn2ba64MUcqJx6CA==' },
                    { src: 'https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/js/bootstrap.min.js', integrity: 'sha512-nKXmKvJyiGQy343jatQlzDprflyB5c+tKCzGP3Uq67v+lmzfnZUi/ZT+fc6ITZfSC5HhaBKUIvr/nTLCV+7F+Q==' }
                ],
                css: [
                    { href: 'https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.8/css/bootstrap.min.css', integrity: 'sha512-2bBQCjcnw658Lho4nlXJcc6WkV/UxpE/sAokbXPxQNGqmNdQrWqtw26Ns9kFF/yG792pKR1Sx8/Y1Lf1XN4GKA==' },
                    { href: 'https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.13.1/font/bootstrap-icons.min.css', integrity: 'sha512-t7Few9xlddEmgd3oKZQahkNI4dS6l80+eGEzFQiqtyVYdvcSG2D3Iub77R20BdotfRPA9caaRkg1tyaJiPmO0g==' }
                ]
            };

            function loadCssItem(item) {
                return new Promise((resolve) => {
                    const link = document.createElement('link');
                    link.rel = 'stylesheet';
                    link.href = item.href;
                    if (item.integrity) link.integrity = item.integrity;
                    link.crossOrigin = 'anonymous';
                    link.referrerPolicy = 'no-referrer';
                    link.onload = () => resolve({ ok: true });
                    link.onerror = () => resolve({ ok: false });
                    document.head.appendChild(link);
                });
            }

            function loadScriptItem(item, isModule) {
                return new Promise((resolve) => {
                    const s = document.createElement('script');
                    s.src = item.src;
                    if (item.integrity) s.integrity = item.integrity;
                    s.crossOrigin = 'anonymous';
                    s.referrerPolicy = 'no-referrer';
                    // ä¿è¯æŒ‰é¡ºåºæ‰§è¡Œ
                    s.async = false;
                    s.onload = () => resolve({ ok: true });
                    s.onerror = () => resolve({ ok: false });
                    document.head.appendChild(s);
                });
            }

            async function tryLoadWithFallback(primaryList, fallbackList, loader) {
                const results = [];
                for (let i = 0; i < primaryList.length; i++) {
                    const p = primaryList[i];
                    const f = fallbackList && fallbackList[i] ? fallbackList[i] : null;
                    const res = await loader(p);
                    if (res.ok) {
                        results.push(true);
                    } else if (f) {
                        const r2 = await loader(f);
                        results.push(r2.ok);
                    } else {
                        results.push(false);
                    }
                }
                return results;
            }

            // å¯åŠ¨åŠ è½½ï¼šå…ˆ css å¹¶è¡ŒåŠ è½½ï¼Œè„šæœ¬æŒ‰é¡ºåºåŠ è½½
            (async function () {
                // CSS: æˆ‘ä»¬å¸Œæœ›å…ˆåŠ è½½ bootstrap CSS ç„¶å iconsï¼Œä½†ä¸¤ä¸ªå¯ä»¥å¹¶è¡Œ
                // ä¸ºæ¯ä¸ª CSS èµ„æºåˆ›å»ºä¸€ä¸ª promiseï¼Œå¤±è´¥æ—¶å›é€€åˆ°å¤‡ç”¨ CDN
                await Promise.all(primary.css.map((p, idx) => {
                    const f = (fallback.css && fallback.css[idx]) ? fallback.css[idx] : null;
                    return loadCssItem(p).then(res => res.ok ? true : (f ? loadCssItem(f).then(r => r.ok) : false));
                }));

                // JS: éœ€è¦æŒ‰é¡ºåºåŠ è½½ sweetalert -> bootstrap
                await tryLoadWithFallback(primary.js, fallback.js, loadScriptItem);
            })();
        })();
    </script>
    <style>
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
        }

        .page-header {
            background-color: #3f6ad8;
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            transition: transform 0.2s;
        }

        .card:hover {
            transform: translateY(-3px);
        }

        .card-header {
            font-weight: 500;
            background-color: rgba(0, 0, 0, 0.02);
            border-bottom: 1px solid rgba(0, 0, 0, 0.03);
        }

        .table {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.05);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .btn-action {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            border-radius: 4px;
            margin-right: 3px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 500;
            color: #495057;
            margin-bottom: 1rem;
            border-left: 3px solid #3f6ad8;
            padding-left: 0.75rem;
        }

        .form-control,
        .form-select {
            border-radius: 0.375rem;
        }

        .btn-group {
            border-radius: 0.375rem;
            overflow: hidden;
        }

        .action-label {
            font-size: 0.75rem;
            display: block;
            text-align: center;
            margin-top: 2px;
            color: #6c757d;
        }

        .actions-container {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .action-button {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .table th {
            font-size: 0.875rem;
            font-weight: 500;
        }

        /* çŠ¶æ€æŒ‡ç¤ºå™¨æ ·å¼ */
        .status-indicator {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            transition: all 0.3s ease;
        }

        .status-light {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .status-light.connected {
            background-color: #28a745;
            box-shadow: 0 0 8px rgba(40, 167, 69, 0.6);
        }

        .status-light.disconnected {
            background-color: #dc3545;
            box-shadow: 0 0 8px rgba(220, 53, 69, 0.6);
            animation: pulse 2s infinite;
        }

        .status-light.warning {
            background-color: #ffc107;
            box-shadow: 0 0 8px rgba(255, 193, 7, 0.6);
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.5;
            }
        }

        .status-text {
            font-size: 0.875rem;
            color: #495057;
            margin: 0;
        }

        .status-indicator:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        /* æ–­å¼€è¿æ¥æ—¶çš„é¢å¤–æç¤ºæ ·å¼ */
        .status-indicator.disconnected-state {
            background: rgba(220, 53, 69, 0.95);
            color: white;
            animation: shake 0.5s ease-in-out;
            animation-delay: 1s;
        }

        .status-indicator.disconnected-state .status-text {
            color: white;
            font-weight: 500;
        }

        .status-indicator.disconnected-state::after {
            content: 'ğŸ‘† ç‚¹å‡»æŸ¥çœ‹è§£å†³æ–¹æ¡ˆ';
            position: absolute;
            bottom: -30px;
            right: 0;
            background: rgba(220, 53, 69, 0.9);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.75rem;
            white-space: nowrap;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
            animation: bounce 2s infinite;
        }

        @keyframes shake {

            0%,
            100% {
                transform: translateX(0);
            }

            25% {
                transform: translateX(-5px);
            }

            75% {
                transform: translateX(5px);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        /* å…¨å±€é®ç½©å±‚ï¼ˆå¯é€‰ï¼Œåœ¨è¿æ¥å¤±è´¥æ—¶é—´è¿‡é•¿æ—¶æ˜¾ç¤ºï¼‰ */
        .connection-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 9999;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .connection-overlay.show {
            display: flex;
        }

        .connection-modal {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .connection-modal h3 {
            color: #dc3545;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .connection-modal p {
            color: #495057;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .connection-modal .btn-primary {
            background: #dc3545;
            border: none;
            padding: 10px 30px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .connection-modal .btn-primary:hover {
            background: #c82333;
        }

        #launcherIcon {
            width: 96px;
            height: 96px;
            object-fit: contain;
            border-radius: 12px;
            background: #f0f0f0;
        }

        #launcherIcon.hidden {
            display: none;
        }

        /* å¢å¼ºçš„ç¦ç”¨æŒ‰é’®æ ·å¼ */
        .btn:disabled,
        .btn.disabled {
            cursor: not-allowed !important;
            opacity: 0.6 !important;
            background-color: #e9ecef !important;
            border-color: #dee2e6 !important;
            color: #adb5bd !important;
            box-shadow: none !important;
            pointer-events: auto !important; /* å…è®¸æ˜¾ç¤ºé¼ æ ‡æ ·å¼ */
        }

        /* ä¸ºä¸‹è½½å’Œæ›´æ–°æŒ‰é’®æ·»åŠ ç‰¹å®šæç¤º */
        #launcherInstallBtn:disabled::after,
        #launcherUpdateBtn:disabled::after {
            content: ' (ä¸å¯ç”¨)';
            font-size: 0.8em;
            margin-left: 4px;
        }
    </style>
</head>

<body>
    <!-- è¿æ¥å¤±è´¥å…¨å±€é®ç½©å±‚ -->
    <div class="connection-overlay" id="connectionOverlay">
        <div class="connection-modal">
            <h3>âš ï¸ å·¥å…·æœªè¿æ¥</h3>
            <p>æ£€æµ‹åˆ°å·¥å…·åç«¯æœåŠ¡æœªè¿è¡Œæˆ–è¿æ¥å¤±è´¥ã€‚<br>è¯·æ£€æŸ¥å·¥å…·æ˜¯å¦æ­£å¸¸å¯åŠ¨ï¼Œæˆ–æŸ¥çœ‹å¸¸è§é—®é¢˜è§£ç­”è·å–å¸®åŠ©ã€‚</p>
            <button class="btn btn-primary" onclick="openFAQAndCloseOverlay()">
                <i class="bi bi-question-circle me-2"></i>æŸ¥çœ‹å¸¸è§é—®é¢˜è§£ç­”
            </button>
            <p class="mt-3 small text-muted">
                <a href="#" onclick="dismissOverlay(); return false;" style="color: #6c757d;">æˆ‘çŸ¥é“äº†ï¼Œæš‚æ—¶å¿½ç•¥</a>
            </p>
        </div>
    </div>

    <!-- çŠ¶æ€æŒ‡ç¤ºå™¨ -->
    <div class="status-indicator" id="statusIndicator">
        <div class="status-light disconnected" id="statusLight"></div>
        <p class="status-text" id="statusText">æ£€æŸ¥ä¸­...</p>
    </div>

    <!-- é¡µé¢å¤´éƒ¨ -->
    <div class="page-header text-center">
        <div class="container">
            <h1 class="fw-bold fs-3">æ¸ é“æœè´¦å·ç®¡ç†ç³»ç»Ÿ</h1>
            <p class="lead fs-6 mb-0">è½»æ¾ç®¡ç†æ‚¨çš„æ¸¸æˆè´¦å·å’Œç™»å½•ä¿¡æ¯</p>
            <p class="small" >
                <a style="color: bisque;" href="https://docs.qq.com/form/page/DTk1LY0ZuZ1h5TmpZ" target="_blank"
                    class="text-decoration-none">ğŸ–Šç‚¹æ­¤å‚ä¸æ–°ç‰ˆæœ¬åŠŸèƒ½æŠ•ç¥¨</a>
            </p>
        </div>
    </div>

    <div class="container">
        <!-- å·¥å…·è®¾ç½®åŒºåŸŸ -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-gear me-2"></i>å·¥å…·è®¾ç½®</span>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <strong>å¼€å¯HTTPDNSå±è”½</strong>
                                <small class="d-block text-muted">å±è”½HTTPDNSæœåŠ¡ä»¥ç¡®ä¿æ‹¦æˆªç”Ÿæ•ˆï¼Œä½†æ˜¯å¯èƒ½å¯¼è‡´éƒ¨åˆ†æ¸¸æˆè”ç½‘å¤±è´¥</small>
                            </div>
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="httpdnsToggle"
                                    onchange="toggleHttpDnsBlocking()">
                                <label class="form-check-label" for="httpdnsToggle"></label>
                            </div>
                        </div>
                        <div id="httpdnsStatus" class="mt-2">
                            <small class="text-muted">çŠ¶æ€ï¼š<span id="httpdnsStatusText">åŠ è½½ä¸­...</span></small>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <strong>æ—¥å¿—å¯¼å‡º</strong>
                                <small class="d-block text-muted">å¯¼å‡ºåŒ…å«ç³»ç»Ÿä¿¡æ¯çš„å®Œæ•´è°ƒè¯•æ—¥å¿—</small>
                            </div>
                            <button onclick="exportLogs()" class="btn btn-outline-info">
                                <i class="bi bi-download me-1"></i>å¯¼å‡ºæ—¥å¿—
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- æ¸¸æˆé€‰æ‹©åŒºåŸŸ -->
        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-controller me-2"></i>æ¸¸æˆé€‰æ‹©</span>
            </div>
            <div class="card-body">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <label for="gameSelect" class="form-label fw-bold">å½“å‰æ¸¸æˆ:</label>
                        <select id="gameSelect" class="form-select" onchange="switchGame(this.value)">
                            <option value="" disabled selected>åŠ è½½ä¸­...</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-rocket-takeoff me-2"></i>æ¸¸æˆå¯åŠ¨å™¨</span>
            </div>
            <div class="card-body">
                <div class="row g-3 align-items-center">
                    <div class="col-md-3 text-center">
                        <img id="launcherIcon" class="hidden" alt="launcher icon">
                    </div>
                    <div class="col-md-9">
                        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
                            <div>
                                <h5 class="mb-1" id="launcherTitle">åŠ è½½ä¸­...</h5>
                                <div class="text-muted small" id="launcherSubTitle">å¯åŠ¨å™¨ä¿¡æ¯</div>
                            </div>
                            <div class="text-muted small" id="launcherInstallPath">æœªå®‰è£…</div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <small>å¼€å‘å•†ï¼š<span id="launcherDeveloper">-</span></small>
                            </div>
                            <div class="col-md-6">
                                <small>å‘è¡Œå•†ï¼š<span id="launcherPublisher">-</span></small>
                            </div>
                        </div>
                        <div class="row mt-2">
                            <div class="col-md-4">
                                <small>æœ¬åœ°ç‰ˆæœ¬ï¼š<span id="launcherLocalVersion">-</span></small>
                            </div>
                            <div class="col-md-4">
                                <small>ç›®æ ‡ç‰ˆæœ¬ï¼š<span id="launcherTargetVersion">-</span></small>
                            </div>
                            <div class="col-md-4">
                                <small>å¯åŠ¨æ–‡ä»¶ï¼š<span id="launcherStartupPath">-</span></small>
                            </div>
                        </div>
                        <div class="mt-3">
                            <label for="launcherDistributionSelect" class="form-label fw-bold">ç‰ˆæœ¬é€‰æ‹©:</label>
                            <select id="launcherDistributionSelect" class="form-select" onchange="updateLauncherDisplay()">
                                <option value="" disabled selected>åŠ è½½ä¸­...</option>
                            </select>
                        </div>
                        <div id="launcherStatusBadges" class="d-flex flex-wrap gap-2 mt-3"></div>
                        <div class="btn-group w-100 mt-3">
                            <button id="launcherInstallBtn" onclick="installLauncher()" class="btn btn-outline-success">
                                <i class="bi bi-download me-1"></i>å®‰è£…/ä¸‹è½½æ–°å¼•æ“
                            </button>
                            <button id="launcherUpdateBtn" onclick="updateLauncher()" class="btn btn-outline-primary">
                                <i class="bi bi-arrow-repeat me-1"></i>æ›´æ–°æ–°å¼•æ“
                            </button>
                            <button id="launcherImportFeverBtn" onclick="importFeverLauncher()" class="btn btn-outline-secondary">
                                <i class="bi bi-box-arrow-in-down me-1"></i>å¯¼å…¥å‘çƒ§å¹³å°å·²æœ‰æ¸¸æˆ
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ“ä½œåŒºåŸŸ -->
        <div class="row">
            <!-- ç™»å½•æ“ä½œ -->
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-box-arrow-in-right me-2"></i>è´¦å·ç™»å½•</span>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="channelSelect" class="form-label">æ¸ é“é€‰æ‹©:</label>
                            <div class="d-flex align-items-center">
                                <select id="channelSelect" class="form-select me-2"
                                    style="width: 80%; flex: 0 0 auto;"></select>
                                <button onclick="manual()" class="btn btn-primary">
                                    <i class="bi bi-person-plus me-1"></i>æ‰‹åŠ¨ç™»å½•
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <p class="mb-1">å½“å‰è‡ªåŠ¨ç™»å½•è´¦å·ï¼š</p>
                            <div class="d-flex align-items-center">
                                <strong id="default" class="badge bg-info text-white p-2">Empty</strong>
                                <button onclick="clearDefault()" class="btn btn-outline-secondary ms-2 btn-sm">
                                    <i class="bi bi-x-circle me-1"></i>æ¸…é™¤è‡ªåŠ¨ç™»å½•
                                </button>
                            </div>
                        </div>
                        <!-- æ·»åŠ ç™»å½•å»¶è¿Ÿè®¾ç½® -->
                        <div class="mt-3">
                            <h5 class="section-title">è‡ªåŠ¨ç™»å½•å»¶è¿Ÿè®¾ç½®</h5>
                            <div class="d-flex align-items-center">
                                <input type="number" id="loginDelayInput" style="width: 80%; flex: 0 0 auto;"
                                    class="form-control me-2" min="0" max="30" placeholder="å»¶è¿Ÿç§’æ•°">
                                <button onclick="saveLoginDelay()" class="btn btn-outline-primary">
                                    <i class="bi bi-save me-1"></i>ä¿å­˜
                                </button>
                            </div>
                            <small class="form-text text-muted mt-1">äºŒç»´ç æ˜¾ç¤ºå<span id="currentDelay">åŠ è½½ä¸­...</span>
                                ç§’ä¼šè‡ªåŠ¨ç™»å½•é»˜è®¤è´¦å·ã€‚</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ç³»ç»Ÿè®¾ç½® -->
            <div class="col-md-6">
                <div class="card h-100">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span><i class="bi bi-gear me-2"></i>è‡ªåŠ¨å¯åŠ¨/å…³é—­è®¾ç½®</span>
                    </div>
                    <div class="card-body">
                        <button id="autoCloseBtn" onclick="switchAutoClose()"
                            class="btn btn-outline-primary mb-3 w-100">
                            <i class="bi bi-power me-1"></i>ç™»å½•åè‡ªåŠ¨å…³é—­å·¥å…·ï¼šåŠ è½½ä¸­...
                        </button>

                        <div class="mt-3">
                            <h5 class="section-title">æ¸¸æˆè‡ªåŠ¨å¯åŠ¨è®¾ç½®</h5>
                            <div class="d-flex align-items-center mb-2">
                                <span>çŠ¶æ€ï¼š</span>
                                <span class="ms-2 badge" id="autoStartStatus">åŠ è½½ä¸­...</span>
                                <span class="ms-3">è·¯å¾„ï¼š</span>
                                <small id="autoStartPath" class="text-muted ms-2 text-truncate">æœªè®¾ç½®</small>
                            </div>
                            <div class="btn-group w-100">
                                <button id="setAutoStartBtn" onclick="setAutoStart(true)"
                                    class="btn btn-outline-success">
                                    <i class="bi bi-plus-circle me-1"></i>è®¾ç½®æ¸¸æˆè·¯å¾„
                                </button>
                                <button id="disableAutoStartBtn" onclick="setAutoStart(false)"
                                    class="btn btn-outline-danger">
                                    <i class="bi bi-dash-circle me-1"></i>ç¦ç”¨è‡ªå¯
                                </button>
                                <button id="startGameBtn" onclick="startGame()" class="btn btn-primary">
                                    <i class="bi bi-play-fill me-1"></i>ç«‹å³å¯åŠ¨æ¸¸æˆ
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è´¦å·åˆ—è¡¨ -->
        <div class="card mt-4">
            <div class="card-header d-flex justify-content-between align-items-center">
                <span><i class="bi bi-list-ul me-2"></i>è´¦å·åˆ—è¡¨</span>
                <div class="btn-group" id="batchOperationsGroup">
                    <button onclick="batchDelete()" class="btn btn-danger btn-sm">
                        <i class="bi bi-trash me-1"></i>æ‰¹é‡åˆ é™¤
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-light">
                            <tr>
                                <th scope="col" width="5%"><input type="checkbox" id="selectAll"></th>
                                <th scope="col" width="20%">UUID</th>
                                <th scope="col" width="20%">åç§°</th>
                                <th scope="col" width="25%">ä¸Šæ¬¡ç™»å½•</th>
                                <th scope="col" width="30%">æ“ä½œ</th>
                            </tr>
                        </thead>
                        <tbody id="channelTableBody">
                            <!-- è´¦å·è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                        </tbody>
                    </table>
                </div>
                <div id="noAccounts" class="alert alert-secondary text-center" style="display:none;">
                    <i class="bi bi-info-circle me-2"></i> æš‚æ— è´¦å·è®°å½•ï¼Œè¯·é€šè¿‡æ‰‹åŠ¨ç™»å½•æˆ–ç”¨æ¸¸æˆå®¢æˆ·ç«¯æ‰«ç æ·»åŠ è´¦å·
                </div>
            </div>
        </div>

        <footer class="mt-4 text-center text-muted">
            <p class="small">IDV-LOGINæ¸ é“æœè´¦å·ç®¡ç†ç•Œé¢ &copy; 2025</p>
            <p class="small">
                <a href="https://www.yuque.com/keygen/kg2r5k/izpgpf4g3ecqsbf3" target="_blank"
                    class="text-decoration-none">å®˜æ–¹æ•™ç¨‹</a>
            </p>
            <p class="small">
                <a href="https://www.yuque.com/keygen/kg2r5k/xl9zosrwviyc54nu" target="_blank"
                    class="text-decoration-none">å‡ºç°é—®é¢˜ï¼Ÿ</a>
            </p>

        </footer>
    </div>


    <script>
        function cmpGameId(game_id_a, game_id_b) {
            if (game_id_a === "" || game_id_b === "") {
                return game_id_a === game_id_b;
            }
            const short_a = game_id_a.split("-").pop();
            const short_b = game_id_b.split("-").pop();
            return short_a === short_b;
        }

        function timeStampToLocalTime(timestamp) {
            return new Date(timestamp * 1000).toLocaleString();
        };
        function renameChannel(uuid) {
            var newName = prompt("è¯·è¾“å…¥æ–°çš„è´¦å·åç§°");
            if (newName) {
                fetch(`/_idv-login/rename?uuid=${uuid}&new_name=${newName}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            swal('è´¦å·å·²æˆåŠŸæ”¹å');
                            location.reload();
                        } else {
                            swal('æ”¹åå¤±è´¥');
                        }
                    });
            }
        }

        function deleteChannel(uuid) {
            swal({
                title: "ç¡®å®šè¦åˆ é™¤è¿™ä¸ªè´¦å·å—ï¼Ÿ",
                text: "åˆ é™¤åå°†æ— æ³•æ¢å¤æ­¤è´¦å·ä¿¡æ¯",
                icon: "warning",
                buttons: ["å–æ¶ˆ", "ç¡®å®šåˆ é™¤"],
                dangerMode: true,
            })
                .then((willDelete) => {
                    if (willDelete) {
                        fetch(`/_idv-login/del?uuid=${uuid}`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.success) {
                                    swal('è´¦å·å·²æˆåŠŸåˆ é™¤', {
                                        icon: "success",
                                    });
                                    location.reload();
                                } else {
                                    swal('åˆ é™¤å¤±è´¥', {
                                        icon: "error",
                                    });
                                }
                            });
                    }
                });
        }

        function batchDelete() {
            // è·å–æ‰€æœ‰é€‰ä¸­çš„è´¦å·
            const selectedAccounts = [];
            document.querySelectorAll('.account-checkbox:checked').forEach(checkbox => {
                selectedAccounts.push(checkbox.value);
            });

            if (selectedAccounts.length === 0) {
                swal({
                    title: "æœªé€‰æ‹©è´¦å·",
                    text: "è¯·å…ˆé€‰æ‹©è¦åˆ é™¤çš„è´¦å·",
                    icon: "warning",
                    button: "ç¡®å®š",
                });
                return;
            }

            swal({
                title: "æ‰¹é‡åˆ é™¤ç¡®è®¤",
                text: `ç¡®å®šè¦åˆ é™¤é€‰ä¸­çš„ ${selectedAccounts.length} ä¸ªè´¦å·å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚`,
                icon: "warning",
                buttons: ["å–æ¶ˆ", "ç¡®å®šåˆ é™¤"],
                dangerMode: true,
            })
                .then((willDelete) => {
                    if (willDelete) {
                        // æ˜¾ç¤ºåŠ è½½ä¸­æç¤º
                        swal({
                            title: "åˆ é™¤ä¸­...",
                            text: "æ­£åœ¨æ‰¹é‡åˆ é™¤è´¦å·",
                            icon: "info",
                            buttons: false,
                            closeOnClickOutside: false,
                        });

                        // åˆ›å»ºä¸€ä¸ªPromiseæ•°ç»„æ¥è·Ÿè¸ªæ‰€æœ‰åˆ é™¤è¯·æ±‚
                        const deletePromises = selectedAccounts.map(uuid => {
                            return fetch(`/_idv-login/del?uuid=${uuid}`)
                                .then(response => response.json())
                                .then(data => ({ uuid, success: data.success }));
                        });

                        // ç­‰å¾…æ‰€æœ‰åˆ é™¤è¯·æ±‚å®Œæˆ
                        Promise.all(deletePromises)
                            .then(results => {
                                const successful = results.filter(r => r.success).length;
                                const failed = results.length - successful;

                                swal({
                                    title: "æ‰¹é‡åˆ é™¤å®Œæˆ",
                                    text: `æˆåŠŸåˆ é™¤ ${successful} ä¸ªè´¦å·${failed > 0 ? `ï¼Œ${failed} ä¸ªè´¦å·åˆ é™¤å¤±è´¥` : ''}`,
                                    icon: successful > 0 ? "success" : "warning",
                                    button: "ç¡®å®š",
                                }).then(() => {
                                    location.reload();
                                });
                            });
                    }
                });
        }

        function switchChannel(uuid) {
            game_id = getQueryVariable("game_id");
            fetch(`/_idv-login/switch?uuid=${uuid}&game_id=${game_id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.current == uuid) {
                        swal({
                            title: "æ¨¡æ‹Ÿç™»å½•æˆåŠŸ",
                            icon: "success",
                            button: "ç¡®å®š",
                        });
                        location.reload();
                    } else {
                        swal({
                            title: "ç™»å½•å¤±è´¥",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                });
        }
        function defaultChannel(uuid) {
            game_id = getQueryVariable("game_id");
            fetch(`/_idv-login/setDefault?uuid=${uuid}&game_id=${game_id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        swal({
                            title: "è®¾ç½®é»˜è®¤è´¦å·æˆåŠŸ",
                            icon: "success",
                            button: "ç¡®å®š",
                        });
                        location.reload();
                    } else {
                        swal({
                            title: "è®¾ç½®å¤±è´¥",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                });
        }

        function clearDefault() {
            game_id = getQueryVariable("game_id");
            fetch(`/_idv-login/clearDefault?game_id=${game_id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        swal({
                            title: "æ¸…é™¤é»˜è®¤è´¦å·æˆåŠŸ",
                            icon: "success",
                            button: "ç¡®å®š",
                        });
                        location.reload();
                    } else {
                        swal({
                            title: "æ¸…é™¤å¤±è´¥",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                });
        }

        // ç™»å½•å»¶è¿Ÿç›¸å…³å‡½æ•°
        function loadLoginDelay() {
            const game_id = getQueryVariable("game_id");
            if (!game_id) return;

            fetch(`/_idv-login/get-login-delay?game_id=${game_id}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('currentDelay').textContent = data.delay;
                    document.getElementById('loginDelayInput').value = data.delay;
                })
                .catch(err => {
                    console.error('è·å–ç™»å½•å»¶è¿Ÿå¤±è´¥:', err);
                    document.getElementById('currentDelay').textContent = 'è·å–å¤±è´¥';
                });
        }

        function saveLoginDelay() {
            const game_id = getQueryVariable("game_id");
            const delay = document.getElementById('loginDelayInput').value;

            if (!game_id) {
                swal({
                    title: "é”™è¯¯",
                    text: "æœªæ‰¾åˆ°æ¸¸æˆID",
                    icon: "error",
                    button: "ç¡®å®š",
                });
                return;
            }

            if (delay === "" || isNaN(delay) || delay < 0) {
                swal({
                    title: "è¾“å…¥é”™è¯¯",
                    text: "è¯·è¾“å…¥æœ‰æ•ˆçš„å»¶è¿Ÿæ—¶é—´ï¼ˆç§’ï¼‰",
                    icon: "warning",
                    button: "ç¡®å®š",
                });
                return;
            }

            fetch(`/_idv-login/set-login-delay?game_id=${game_id}&delay=${delay}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        swal({
                            title: "è®¾ç½®æˆåŠŸ",
                            text: `ç™»å½•å»¶è¿Ÿå·²è®¾ç½®ä¸º ${delay} ç§’`,
                            icon: "success",
                            button: "ç¡®å®š",
                        });
                        document.getElementById('currentDelay').textContent = delay;
                    } else {
                        swal({
                            title: "è®¾ç½®å¤±è´¥",
                            text: data.error || "æœªçŸ¥é”™è¯¯",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                })
                .catch(err => {
                    swal({
                        title: "è¯·æ±‚å¤±è´¥",
                        text: "ä¿å­˜å»¶è¿Ÿè®¾ç½®æ—¶å‘ç”Ÿé”™è¯¯",
                        icon: "error",
                        button: "ç¡®å®š",
                    });
                });
        }

        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) { return pair[1]; }
            }
            return ("");
        }

        // æ¸¸æˆåˆ‡æ¢å‡½æ•°
        function switchGame(gameId) {
            if (gameId) {
                // æ˜¾ç¤ºåŠ è½½ä¸­æç¤º
                swal({
                    title: "åˆ‡æ¢æ¸¸æˆä¸­...",
                    text: "æ­£åœ¨åŠ è½½æ¸¸æˆæ•°æ®",
                    icon: "info",
                    buttons: false,
                    closeOnClickOutside: false,
                });

                // é‡å®šå‘åˆ°ç›¸åŒçš„URLï¼Œä½†æ”¹å˜game_idæŸ¥è¯¢å‚æ•°
                const currentUrl = new URL(window.location.href);
                currentUrl.searchParams.set('game_id', gameId);
                window.location.href = currentUrl.toString();
            }
        }

        // åŠ è½½æ¸¸æˆåˆ—è¡¨
        function loadGameList() {
            fetch('/_idv-login/list-games')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const gameSelect = document.getElementById('gameSelect');
                        // æ¸…ç©ºç°æœ‰é€‰é¡¹
                        gameSelect.innerHTML = '';

                        // è·å–å½“å‰é€‰ä¸­çš„æ¸¸æˆID
                        const currentGameId = getQueryVariable("game_id");

                        // æ·»åŠ æ¸¸æˆé€‰é¡¹
                        data.games.forEach(game => {
                            const option = document.createElement('option');
                            option.value = game.game_id;
                            option.text = game.name || game.game_id;
                            option.selected = cmpGameId(game.game_id, currentGameId);
                            gameSelect.appendChild(option);
                        });

                        // å¦‚æœæ²¡æœ‰å½“å‰æ¸¸æˆIDæˆ–åˆ—è¡¨ä¸­æ²¡æœ‰æ­¤æ¸¸æˆ
                        if (!currentGameId && data.games.length > 0) {
                            switchGame(data.games[0].game_id);
                        }
                        //å¦‚æœå½“å‰æœ‰idä½†æ˜¯åˆ—è¡¨ä¸­æ²¡æœ‰ï¼Œå±•ç¤ºå½“å‰id
                        has_match = false;
                        for (var i = 0; i < data.games.length; i++) {
                            if (cmpGameId(data.games[i].game_id, currentGameId)) {
                                has_match = true;
                                break;
                            }
                        }
                        if (!has_match) {
                            option = document.createElement('option');
                            option.value = currentGameId;
                            option.text = currentGameId;
                            option.selected = true;
                            gameSelect.appendChild(option);
                        }
                    } else {
                        console.error('è·å–æ¸¸æˆåˆ—è¡¨å¤±è´¥');
                        document.getElementById('gameSelect').innerHTML = '<option value="">åŠ è½½å¤±è´¥</option>';
                    }
                });
        }

        // è‡ªåŠ¨å¯åŠ¨ç›¸å…³å‡½æ•°
        function loadAutoStartSettings() {
            const game_id = getQueryVariable("game_id");
            fetch(`/_idv-login/get-game-auto-start?game_id=${game_id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateAutoStartUI(data.enabled, data.path);
                    } else {
                        swal({
                            title: "è·å–è‡ªåŠ¨å¯åŠ¨è®¾ç½®å¤±è´¥",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                });
        }

        function updateAutoStartUI(enabled, path) {
            const statusElement = document.getElementById('autoStartStatus');
            const pathElement = document.getElementById('autoStartPath');
            const setBtn = document.getElementById('setAutoStartBtn');
            const disableBtn = document.getElementById('disableAutoStartBtn');
            const startBtn = document.getElementById('startGameBtn');

            statusElement.textContent = enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
            statusElement.className = enabled ? 'ms-2 badge bg-success' : 'ms-2 badge bg-secondary';

            if (path) {
                pathElement.textContent = path;
                pathElement.title = path; // æ·»åŠ å®Œæ•´è·¯å¾„ä½œä¸ºæç¤º
            } else {
                pathElement.textContent = 'æœªè®¾ç½®';
                pathElement.title = '';
            }

            setBtn.disabled = enabled;
            disableBtn.disabled = !enabled;
            startBtn.disabled = !enabled || !path;
        }

        function setAutoStart(enabled) {
            const game_id = getQueryVariable("game_id");
            fetch(`/_idv-login/set-game-auto-start?game_id=${game_id}&enabled=${enabled}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateAutoStartUI(data.enabled, data.path);
                        if (enabled) {
                            if (data.path) {
                                swal({
                                    title: "è®¾ç½®æˆåŠŸ",
                                    text: "å·²æˆåŠŸè®¾ç½®æ¸¸æˆè‡ªåŠ¨å¯åŠ¨",
                                    icon: "success",
                                    button: "ç¡®å®š",
                                });
                            } else {
                                swal({
                                    title: "è®¾ç½®å·²å–æ¶ˆ",
                                    text: "å–æ¶ˆäº†æ¸¸æˆè·¯å¾„é€‰æ‹©ï¼Œæœªå¯ç”¨è‡ªåŠ¨å¯åŠ¨",
                                    icon: "info",
                                    button: "ç¡®å®š",
                                });
                            }
                        } else {
                            swal({
                                title: "å·²ç¦ç”¨",
                                text: "å·²ç¦ç”¨æ¸¸æˆè‡ªåŠ¨å¯åŠ¨åŠŸèƒ½",
                                icon: "info",
                                button: "ç¡®å®š",
                            });
                        }
                    } else {
                        swal({
                            title: "è®¾ç½®å¤±è´¥",
                            text: data.error || 'æœªçŸ¥é”™è¯¯',
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                });
        }

        function startGame() {
            const game_id = getQueryVariable("game_id");

            swal({
                title: "æ­£åœ¨å¯åŠ¨æ¸¸æˆ",
                text: "è¯·ç¨å€™...",
                icon: "info",
                buttons: false,
                closeOnClickOutside: false,
            });

            fetch(`/_idv-login/start-game?game_id=${game_id}`)
                .then(response => response.json())
                .then(data => {
                    swal.close();
                    if (data.success) {
                        swal({
                            title: "æ¸¸æˆå¯åŠ¨ä¸­",
                            text: "å¦‚æœæ¸¸æˆæ²¡æœ‰è‡ªåŠ¨å¯åŠ¨ï¼Œè¯·æ£€æŸ¥æ¸¸æˆè·¯å¾„æ˜¯å¦æ­£ç¡®",
                            icon: "success",
                            button: "ç¡®å®š",
                        });
                    } else {
                        swal({
                            title: "å¯åŠ¨å¤±è´¥",
                            text: data.error || 'æœªçŸ¥é”™è¯¯',
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                });
        }

        let launcherState = null;
        let updateRequired = false;

        function formatSize(bytes) {
            if (bytes === null || bytes === undefined) return '-';
            const value = Number(bytes);
            if (!Number.isFinite(value)) return '-';
            if (value <= 0) return '0 B';
            const units = ['B', 'KB', 'MB', 'GB', 'TB'];
            let size = value;
            let idx = 0;
            while (size >= 1024 && idx < units.length - 1) {
                size /= 1024;
                idx += 1;
            }
            return `${size.toFixed(size >= 10 || idx === 0 ? 0 : 2)} ${units[idx]}`;
        }

        function markUpdateRequired() {
            updateRequired = true;
            const statusLight = document.getElementById('statusLight');
            const statusText = document.getElementById('statusText');
            const statusIndicator = document.getElementById('statusIndicator');
            if (statusLight) statusLight.className = 'status-light warning';
            if (statusText) statusText.textContent = 'è¯·æ›´æ–°å·¥å…·';
            if (statusIndicator) statusIndicator.title = 'å·¥å…·ç‰ˆæœ¬è¿‡æ—§ï¼Œè¯·æ›´æ–°';
        }

        function fetchLauncherJson(url, options) {
            return fetch(url, options).then(response => {
                if (response.status === 404) {
                    markUpdateRequired();
                    const err = new Error('not_found');
                    err.isNotFound = true;
                    throw err;
                }
                return response.json();
            });
        }

        function loadLauncherStatus() {
            const game_id = getQueryVariable("game_id");
            if (!game_id) return;
            fetchLauncherJson(`/_idv-login/launcher-status?game_id=${game_id}`)
                .then(data => {
                    if (!data.success) {
                        throw new Error(data.error || 'è·å–å¯åŠ¨å™¨ä¿¡æ¯å¤±è´¥');
                    }
                    launcherState = data;
                    renderLauncherDistributionOptions();
                    updateLauncherDisplay();
                })
                .catch(error => {
                    if (error && error.isNotFound) {
                        return;
                    }
                    launcherState = null;
                    document.getElementById('launcherTitle').textContent = 'å¯åŠ¨å™¨ä¿¡æ¯åŠ è½½å¤±è´¥';
                });
        }

        function renderLauncherDistributionOptions() {
            const select = document.getElementById('launcherDistributionSelect');
            select.innerHTML = '';
            if (!launcherState || !launcherState.distributions || launcherState.distributions.length === 0) {
                select.innerHTML = '<option value="" disabled selected>æš‚æ— ç‰ˆæœ¬</option>';
                return;
            }
            const defaultId = launcherState.game.default_distribution;
            launcherState.distributions.forEach(item => {
                const option = document.createElement('option');
                option.value = item.distribution_id;
                option.text = `åˆ†å‘ ${item.distribution_id}`;
                if (String(item.distribution_id) === String(defaultId)) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        function updateLauncherDisplay() {
            if (!launcherState) return;
            const select = document.getElementById('launcherDistributionSelect');
            let distId = select.value;
            if (!distId && launcherState.distributions.length) {
                distId = launcherState.distributions[0].distribution_id;
                select.value = distId;
            }
            const dist = launcherState.distributions.find(item => String(item.distribution_id) === String(distId));
            const launcher = dist ? (dist.launcher || {}) : {};

            document.getElementById('launcherTitle').textContent = launcher.display_name || launcher.app_name || launcherState.game_id;
            document.getElementById('launcherSubTitle').textContent = launcher.app_name || launcher.display_name || 'å¯åŠ¨å™¨ä¿¡æ¯';
            document.getElementById('launcherDeveloper').textContent = launcher.developer || '-';
            document.getElementById('launcherPublisher').textContent = launcher.publisher || '-';
            document.getElementById('launcherLocalVersion').textContent = launcherState.game.version || 'æœªçŸ¥';
            document.getElementById('launcherTargetVersion').textContent = dist && dist.target_version ? dist.target_version : 'æœªçŸ¥';
            document.getElementById('launcherStartupPath').textContent = launcher.startup_path || 'æœªçŸ¥';
            document.getElementById('launcherInstallPath').textContent = launcherState.game.installed ? (launcherState.game.path || 'å·²å®‰è£…') : 'æœªå®‰è£…';

            const iconEl = document.getElementById('launcherIcon');
            const iconSrc = launcher.logo || launcher.icon || '';
            if (iconSrc) {
                iconEl.src = iconSrc;
                iconEl.classList.remove('hidden');
            } else {
                iconEl.classList.add('hidden');
            }

            const badges = [];
            badges.push({ text: launcherState.game.installed ? 'å·²å®‰è£…' : 'æœªå®‰è£…', color: launcherState.game.installed ? 'success' : 'secondary' });
            badges.push({ text: dist && dist.can_update ? 'å¯æ›´æ–°' : 'æ— éœ€æ›´æ–°', color: dist && dist.can_update ? 'warning' : 'secondary' });
            badges.push({ text: dist && dist.can_download ? 'å¯ä¸‹è½½' : 'ä¸å¯ä¸‹è½½', color: dist && dist.can_download ? 'info' : 'secondary' });
            badges.push({ text: launcherState.game.can_convert ? 'å¯è½¬æ¢' : 'æ— éœ€è½¬æ¢', color: launcherState.game.can_convert ? 'primary' : 'secondary' });
            if (launcherState.game.is_fever) {
                badges.push({ text: 'Feverç‰ˆæœ¬', color: 'dark' });
            }
            const badgeContainer = document.getElementById('launcherStatusBadges');
            badgeContainer.innerHTML = '';
            badges.forEach(item => {
                const span = document.createElement('span');
                span.className = `badge bg-${item.color}`;
                span.textContent = item.text;
                badgeContainer.appendChild(span);
            });

            const installBtn = document.getElementById('launcherInstallBtn');
            const updateBtn = document.getElementById('launcherUpdateBtn');
            const importBtn = document.getElementById('launcherImportFeverBtn');
            installBtn.disabled = launcherState.game.installed || !(dist && dist.can_download);
            updateBtn.disabled = !(dist && dist.can_update);
            importBtn.disabled = !launcherState.can_import_fever;
            //å¦‚æœæ˜¯ç¬¬äº”äººæ ¼æ–°å¼•æ“ï¼Œåˆ™ç›´æ¥æ˜¾ç¤ºå¯ä»¥å¯¼å…¥
            if (launcherState.game_id!='h55' && launcherState.game_id.endsWith('h55')){
                importBtn.disabled=false;
            }
        }

        function installLauncher() {
            if (!launcherState) return;
            const distId = document.getElementById('launcherDistributionSelect').value;
            if (!distId) return;
            swal({
                title: "å¼€å§‹å®‰è£…",
                text: "è¯·é€‰æ‹©å®‰è£…ç›®å½•å¹¶ç­‰å¾…ä¸‹è½½å®Œæˆ",
                icon: "info",
                buttons: false,
                closeOnClickOutside: false,
            });
            fetchLauncherJson(`/_idv-login/launcher-install?game_id=${launcherState.game_id}&distribution_id=${distId}`)
                .then(data => {
                    swal.close();
                    if (data.success) {
                        swal({
                            title: "å®‰è£…å®Œæˆ",
                            text: data.converted ? "ä¸‹è½½å®Œæˆå¹¶å·²å®Œæˆè½¬æ¢" : "ä¸‹è½½å®Œæˆ",
                            icon: "success",
                            button: "ç¡®å®š",
                        }).then(() => {
                            loadGameList();
                            loadLauncherStatus();
                        });
                    } else {
                        swal({
                            title: "å®‰è£…å¤±è´¥",
                            text: data.error || "å®‰è£…è¿‡ç¨‹å¤±è´¥",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                })
                .catch(error => {
                    if (error && error.isNotFound) {
                        swal.close();
                        return;
                    }
                    swal({
                        title: "è¯·æ±‚å¤±è´¥",
                        text: "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨",
                        icon: "error",
                        button: "ç¡®å®š",
                    });
                });
        }

        function updateLauncher() {
            if (!launcherState) return;
            const distId = document.getElementById('launcherDistributionSelect').value;
            if (!distId) return;
            fetchLauncherJson(`/_idv-login/launcher-update-info?game_id=${launcherState.game_id}&distribution_id=${distId}`)
                .then(info => {
                    if (!info.success) {
                        throw new Error(info.error || 'è·å–æ›´æ–°ä¿¡æ¯å¤±è´¥');
                    }
                    //å¦‚æœä¸‹è½½æ–‡ä»¶å¤§å°æ˜¯96Bï¼Œè€Œä¸”éœ€è¦æ›´æ–°æ–‡ä»¶çš„æ•°é‡æ˜¯1ï¼Œåˆ™æç¤ºç”¨æˆ·å·²ç»å®Œæˆç»•è¿‡å‘çƒ§å¹³å°å¤„ç†ï¼Œæ— éœ€æ›´æ–°
                    if (info.download_bytes==96 && info.file_count==1){
                        return swal({
                            title: "æ­å–œ",
                            text: "å·²ç»å®Œæˆç»•è¿‡å‘çƒ§å¹³å°å¤„ç†ï¼Œæ— éœ€æ›´æ–°ã€‚è¿™ä¸ªå¼¹çª—å°†åœ¨ä¸‹ä¸€ä¸ªæ›´æ–°ä¸­å»é™¤OVO",
                            icon: "info",
                            button: "ç¡®å®š",
                        });
                        return;
                    }
                    const downloadText = info.needs_update
                        ? `éœ€è¦ä¸‹è½½ï¼š${formatSize(info.download_bytes)}ï¼ˆ${info.file_count}ä¸ªæ–‡ä»¶ï¼‰`
                        : 'æ— éœ€ä¸‹è½½ï¼Œå·²æ˜¯æœ€æ–°ç‰ˆæœ¬';
                    const diskText = `ç£ç›˜å‰©ä½™ï¼š${formatSize(info.disk_free_bytes)}`;
                    return swal({
                        title: "æ›´æ–°æç¤º",
                        text: `${downloadText}\n${diskText}`,
                        icon: "info",
                        buttons: ["å–æ¶ˆ", "ç»§ç»­æ›´æ–°"],
                    });
                })
                .then(shouldUpdate => {
                    if (!shouldUpdate) return;
                    swal({
                        title: "æ­£åœ¨æ›´æ–°",
                        text: "è¯·ç¨å€™...",
                        icon: "info",
                        buttons: false,
                        closeOnClickOutside: false,
                    });
                    return fetchLauncherJson(`/_idv-login/launcher-update?game_id=${launcherState.game_id}&distribution_id=${distId}`);
                })
                .then(data => {
                    if (!data) return;
                    swal.close();
                    if (data.success) {
                        swal({
                            title: "æ›´æ–°å·²åœ¨åå°å¯åŠ¨",
                            text: data.converted ? "æ›´æ–°å®Œæˆå¹¶å·²å®Œæˆè½¬æ¢" : "è¯·ç•™æ„å·¥å…·çš„æ–°çª—å£ï¼Œåº”è¯¥ä¼šå¯åŠ¨ä¸¤ä¸ªçª—å£ï¼Œå…¶ä¸­ä¸€ä¸ªçª—å£ä¼šå±•ç¤ºè¿›åº¦ï¼æ›´æ–°å®Œå°†ä¼šå¼¹å‡ºæ¸¸æˆæ‰€åœ¨ä½ç½®ï¼Œè¯·æ³¨æ„è®°å½•ã€‚",
                            icon: "success",
                            button: "ç¡®å®š",
                        }).then(() => {
                            loadLauncherStatus();
                        });
                    } else {
                        swal({
                            title: "æ›´æ–°å¤±è´¥",
                            text: data.error || "æ›´æ–°è¿‡ç¨‹å¤±è´¥",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                })
                .catch(error => {
                    if (error && error.isNotFound) {
                        return;
                    }
                    swal({
                        title: "è¯·æ±‚å¤±è´¥",
                        text: "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨",
                        icon: "error",
                        button: "ç¡®å®š",
                    });
                });
        }

        function importFeverLauncher() {
            if (!launcherState) return;
            //ä»¥h55ç»“æŸ
            if (launcherState.game_id!='h55' && launcherState.game_id.endsWith('h55')){
                //è¯¢é—®ç”¨æˆ·æ˜¯å¦æ˜¯æƒ³è¦å¯¼å…¥å·²ç»å®‰è£…çš„ç¬¬äº”äººæ ¼æ–°å¼•æ“
                swal({
                    title: "ä»å‘çƒ§å¹³å°å¯¼å…¥ç¬¬äº”äººæ ¼æ–°å¼•æ“",
                    text: "æ˜¯å¦å¯¼å…¥å·²ç»å®‰è£…çš„ç¬¬äº”äººæ ¼æ–°å¼•æ“ï¼Ÿå¯¼å…¥åï¼Œæ¸¸æˆå¯ä»¥ç›´æ¥å¯åŠ¨ï¼Œä¹Ÿå¯ä»¥ç”¨å·¥å…·å¯åŠ¨ï¼Œå®ç°å…æ‰«ç åŠŸèƒ½ï¼Œä¸æ—§å¼•æ“çš„ç™»å½•ä½“éªŒä¸€è‡´ã€‚",
                    icon: "warning",
                    buttons: ["å–æ¶ˆ", "æˆ‘å·²ç»åœ¨å‘çƒ§å¹³å°å®‰è£…æ¸¸æˆï¼Œç»§ç»­å¯¼å…¥"],
                }).then(shouldImport => {
                    if (!shouldImport) return;
                    //ä¿®æ”¹å½“å‰é¡µé¢æŸ¥è¯¢å‚æ•°
                    const url = new URL(window.location.href);
                    url.searchParams.set('game_id', "h55");
                    window.location = url;
                });
                return;
            }
            swal({
                title: "å¯¼å…¥ä¸­...",
                text: "æ­£åœ¨å¯¼å…¥Feverå¹³å°æ¸¸æˆè®°å½•",
                icon: "info",
                buttons: false,
                closeOnClickOutside: false,
            });
            fetchLauncherJson(`/_idv-login/launcher-import-fever?game_id=${launcherState.game_id}`)
                .then(data => {
                    swal.close();
                    if (data.success) {
                        swal({
                            title: "å¯¼å…¥å®Œæˆ",
                            icon: "success",
                            button: "ç¡®å®š",
                        }).then(() => {
                            loadGameList();
                            loadLauncherStatus();
                        });
                    } else {
                        swal({
                            title: "å¯¼å…¥å¤±è´¥",
                            text: data.error || "æœªæ‰¾åˆ°å¯å¯¼å…¥è®°å½•",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                })
                .catch(error => {
                    if (error && error.isNotFound) {
                        swal.close();
                        return;
                    }
                    swal({
                        title: "è¯·æ±‚å¤±è´¥",
                        text: "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨",
                        icon: "error",
                        button: "ç¡®å®š",
                    });
                });
        }

        // åœ¨é¡µé¢åŠ è½½æ—¶è·å–è´¦å·åˆ—è¡¨
        window.onload = function () {
            //è·å¾—queryå‚æ•°game_id
            game_id = getQueryVariable("game_id");

            // å¯åŠ¨å·¥å…·çŠ¶æ€æ£€æŸ¥
            startStatusCheck();

            // é¦–å…ˆåŠ è½½æ¸¸æˆåˆ—è¡¨
            loadGameList();

            // åŠ è½½HTTPDNSå±è”½çŠ¶æ€
            loadHttpDnsStatus();

            // å¦‚æœæœ‰game_idï¼ŒåŠ è½½è¯¥æ¸¸æˆçš„è´¦å·å’Œè®¾ç½®
            if (game_id) {
                // åŠ è½½ç™»å½•å»¶è¿Ÿè®¾ç½®
                loadLoginDelay();

                fetch('/_idv-login/list?game_id=' + game_id)
                    .then(response => response.json())
                    .then(data => {
                        var tableBody = document.getElementById('channelTableBody');
                        var noAccountsDiv = document.getElementById('noAccounts');
                        var batchOperationsGroup = document.getElementById('batchOperationsGroup');

                        // æ¸…ç©ºè¡¨æ ¼
                        tableBody.innerHTML = '';

                        if (data.length === 0) {
                            noAccountsDiv.style.display = 'block';
                            batchOperationsGroup.style.display = 'none'; // æ²¡æœ‰è´¦å·æ—¶éšè—æ‰¹é‡æ“ä½œ
                        } else {
                            noAccountsDiv.style.display = 'none';
                            batchOperationsGroup.style.display = 'block'; // æœ‰è´¦å·æ—¶æ˜¾ç¤ºæ‰¹é‡æ“ä½œ

                            data.forEach(channel => {
                                // å¦‚æœuuidä»¥neteaseå¼€å¤´ï¼Œåˆ™è·³è¿‡ä¸æ˜¾ç¤º
                                if (channel.uuid.startsWith('netease')) {
                                    return;
                                }

                                var row = tableBody.insertRow();
                                row.insertCell().innerHTML = `<input type="checkbox" class="account-checkbox" value="${channel.uuid}">`;

                                var uuidCell = row.insertCell();
                                uuidCell.innerHTML = `<span class="badge bg-light text-dark">${channel.uuid}</span>`;
                                uuidCell.title = channel.uuid;

                                row.insertCell().innerHTML = channel.name;
                                row.insertCell().innerHTML = `<small>${timeStampToLocalTime(channel.last_login_time)}</small>`;

                                var actionsCell = row.insertCell();
                                actionsCell.innerHTML = `
                                    <div class="actions-container">
                                        <div class="action-button">
                                            <button onclick="switchChannel('${channel.uuid}')" class="btn btn-sm btn-primary btn-action">
                                                <i class="bi bi-box-arrow-in-right"></i>
                                            </button>
                                            <span class="action-label">ç™»å½•</span>
                                        </div>
                                        <div class="action-button">
                                            <button onclick="renameChannel('${channel.uuid}')" class="btn btn-sm btn-info btn-action text-white">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                            <span class="action-label">æ”¹å</span>
                                        </div>
                                        <div class="action-button">
                                            <button onclick="deleteChannel('${channel.uuid}')" class="btn btn-sm btn-danger btn-action">
                                                <i class="bi bi-trash"></i>
                                            </button>
                                            <span class="action-label">åˆ é™¤</span>
                                        </div>
                                        <div class="action-button">
                                            <button onclick="defaultChannel('${channel.uuid}')" class="btn btn-sm btn-success btn-action">
                                                <i class="bi bi-star"></i>
                                            </button>
                                            <span class="action-label">è‡ªåŠ¨ç™»å½•</span>
                                        </div>
                                    </div>
                                `;
                            });

                            // å…¨é€‰åŠŸèƒ½
                            document.getElementById('selectAll').addEventListener('change', function () {
                                const checkboxes = document.querySelectorAll('.account-checkbox');
                                checkboxes.forEach(checkbox => {
                                    checkbox.checked = this.checked;
                                });
                            });
                        }
                    });

                fetch('/_idv-login/manualChannels')
                    .then(response => response.json())
                    .then(data => {
                        var channelSelect = document.getElementById('channelSelect');
                        // æ¸…ç©ºä¸‹æ‹‰æ¡†
                        channelSelect.innerHTML = '';

                        data.forEach(channel => {
                            var option = document.createElement('option');
                            option.value = channel.channel;
                            option.text = channel.name;
                            channelSelect.appendChild(option);
                        });
                    });

                fetch('/_idv-login/defaultChannel?game_id=' + game_id)
                    .then(response => response.json())
                    .then(data => {
                        if (data.uuid != "") {
                            document.getElementById('default').innerText = data.uuid;
                            document.getElementById('default').className = 'badge bg-success text-white p-2';
                        } else {
                            document.getElementById('default').innerText = 'Empty';
                            document.getElementById('default').className = 'badge bg-info text-white p-2';
                        }
                    });

                // è·å–è‡ªåŠ¨å…³é—­çŠ¶æ€
                fetch(`/_idv-login/get-auto-close-state?game_id=${game_id}`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            updateAutoCloseButton(data.state);
                        }
                    });

                // åŠ è½½è‡ªåŠ¨å¯åŠ¨è®¾ç½®
                loadAutoStartSettings();
                loadLauncherStatus();
            }
        }

        // æ·»åŠ æ–°çš„å‡½æ•°
        function updateAutoCloseButton(state) {
            const btn = document.getElementById('autoCloseBtn');
            if (state) {
                btn.innerHTML = `<i class="bi bi-power me-1"></i>ç™»å½•åè‡ªåŠ¨å…³é—­å·¥å…·ï¼šå¼€å¯`;
                btn.className = 'btn btn-success w-100';
            } else {
                btn.innerHTML = `<i class="bi bi-power me-1"></i>ç™»å½•åè‡ªåŠ¨å…³é—­å·¥å…·ï¼šå…³é—­`;
                btn.className = 'btn btn-outline-secondary w-100';
            }
        }

        function switchAutoClose() {
            game_id = getQueryVariable("game_id");
            fetch(`/_idv-login/switch-auto-close-state?game_id=${game_id}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        updateAutoCloseButton(data.state);
                        swal({
                            title: data.state ? "è‡ªåŠ¨å…³é—­å·²å¼€å¯" : "è‡ªåŠ¨å…³é—­å·²å…³é—­",
                            text: data.state ? "ç™»å½•æˆåŠŸåå°†è‡ªåŠ¨å…³é—­å·¥å…·" : "ç™»å½•åå·¥å…·å°†ä¿æŒè¿è¡Œ",
                            icon: "success",
                            button: "ç¡®å®š",
                        });
                    } else {
                        swal({
                            title: "åˆ‡æ¢çŠ¶æ€å¤±è´¥",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                });
        }
        function exportLogs() {
            const downloadLink = document.createElement('a');
            downloadLink.href = '/_idv-login/export-logs';
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);

            // ç›‘å¬ä¸‹è½½å®Œæˆ
            downloadLink.addEventListener('click', function () {
                setTimeout(() => {
                    swal({
                        title: "æ—¥å¿—å¯¼å‡ºæˆåŠŸ",
                        text: "è°ƒè¯•æ—¥å¿—æ–‡ä»¶å·²å¼€å§‹ä¸‹è½½ã€‚å…¶ä¸­åŒ…å«æ“ä½œç³»ç»Ÿã€è®¡ç®—æœºã€IPã€å·²å®‰è£…åº”ç”¨åˆ—è¡¨ã€è¿›ç¨‹ã€ä»£ç†çŠ¶æ€ç­‰è¯Šæ–­ä¿¡æ¯ï¼Œåˆ†äº«å‰è¯·æ³¨æ„ä¸ªäººéšç§ã€‚",
                        icon: "success",
                        button: "ç¡®å®š",
                    });
                    document.body.removeChild(downloadLink);
                }, 1000);
            });

            // è§¦å‘ä¸‹è½½
            downloadLink.click();
        }

        // HTTPDNSå±è”½åŠŸèƒ½ç›¸å…³å‡½æ•°
        function loadHttpDnsStatus() {
            fetch('/_idv-login/get-httpdns-status')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const toggle = document.getElementById('httpdnsToggle');
                        const statusText = document.getElementById('httpdnsStatusText');

                        toggle.checked = data.enabled;
                        statusText.textContent = data.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                        statusText.className = data.enabled ? 'text-success' : 'text-warning';
                    } else {
                        document.getElementById('httpdnsStatusText').textContent = 'è·å–çŠ¶æ€å¤±è´¥ï¼Œè¯·æ›´æ–°å·¥å…·åˆ°æœ€æ–°ç‰ˆæœ¬';
                        document.getElementById('httpdnsStatusText').className = 'text-danger';
                    }
                })
                .catch(error => {
                    console.error('è·å–HTTPDNSçŠ¶æ€å¤±è´¥:', error);
                    document.getElementById('httpdnsStatusText').textContent = 'è·å–çŠ¶æ€å¤±è´¥';
                    document.getElementById('httpdnsStatusText').className = 'text-danger';
                });
        }

        function toggleHttpDnsBlocking() {
            const toggle = document.getElementById('httpdnsToggle');
            const statusText = document.getElementById('httpdnsStatusText');

            // æ˜¾ç¤ºåˆ‡æ¢ä¸­çŠ¶æ€
            statusText.textContent = 'åˆ‡æ¢ä¸­...';
            statusText.className = 'text-info';

            fetch('/_idv-login/toggle-httpdns-blocking', {
                method: 'POST'
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                        statusText.textContent = data.enabled ? 'å·²å¯ç”¨' : 'å·²ç¦ç”¨';
                        statusText.className = data.enabled ? 'text-success' : 'text-warning';

                        // æ˜¾ç¤ºæ“ä½œç»“æœ
                        let message = data.enabled ?
                            'HTTPDNSå±è”½å·²å¯ç”¨ï¼Œæ¸¸æˆçš„HTTPDNSæœåŠ¡å°†è¢«å±è”½' :
                            'HTTPDNSå±è”½å·²ç¦ç”¨';

                        if (!data.enabled && data.unblock_result) {
                            message += '\né˜²ç«å¢™è§„åˆ™è§£é™¤ç»“æœï¼š' + data.unblock_result;
                        }

                        swal({
                            title: data.enabled ? "HTTPDNSå±è”½å·²å¯ç”¨" : "HTTPDNSå±è”½å·²ç¦ç”¨",
                            text: message + (data.warning ? '\n\nâš ï¸ ' + data.warning : ''),
                            icon: "success",
                            button: "ç¡®å®š",
                        });
                    } else {
                        // æ“ä½œå¤±è´¥ï¼Œæ¢å¤å¼€å…³çŠ¶æ€
                        toggle.checked = !toggle.checked;
                        statusText.textContent = 'åˆ‡æ¢å¤±è´¥ï¼Œè¯·æ›´æ–°å·¥å…·åˆ°æœ€æ–°ç‰ˆæœ¬å¹¶æ£€æŸ¥æ—¥å¿—';
                        statusText.className = 'text-danger';

                        swal({
                            title: "æ“ä½œå¤±è´¥",
                            text: data.message || "åˆ‡æ¢HTTPDNSå±è”½çŠ¶æ€å¤±è´¥ï¼Œè¯·æ›´æ–°å·¥å…·åˆ°æœ€æ–°ç‰ˆæœ¬å¹¶æ£€æŸ¥æ—¥å¿—",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                })
                .catch(error => {
                    console.error('åˆ‡æ¢HTTPDNSå±è”½å¤±è´¥:', error);
                    // æ“ä½œå¤±è´¥ï¼Œæ¢å¤å¼€å…³çŠ¶æ€
                    toggle.checked = !toggle.checked;
                    statusText.textContent = 'åˆ‡æ¢å¤±è´¥';
                    statusText.className = 'text-danger';

                    swal({
                        title: "ç½‘ç»œé”™è¯¯",
                        text: "æ— æ³•è¿æ¥åˆ°æœåŠ¡å™¨ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥",
                        icon: "error",
                        button: "ç¡®å®š",
                    });
                });
        }

        // å·¥å…·çŠ¶æ€æ£€æŸ¥åŠŸèƒ½
        let statusCheckInterval = null;
        let disconnectedCount = 0;
        let overlayDismissed = false;  // æ ‡è®°ç”¨æˆ·æ˜¯å¦å·²æ‰‹åŠ¨å…³é—­é®ç½©
        const FAQ_URL = 'https://www.yuque.com/keygen/kg2r5k/xl9zosrwviyc54nu';

        function checkToolStatus() {
            const statusLight = document.getElementById('statusLight');
            const statusText = document.getElementById('statusText');
            const statusIndicator = document.getElementById('statusIndicator');
            const connectionOverlay = document.getElementById('connectionOverlay');

            fetch('/_idv-login/list-games')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    // è¿æ¥æˆåŠŸ
                    disconnectedCount = 0;
                    overlayDismissed = false;  // é‡ç½®å…³é—­æ ‡è®°
                    if (updateRequired) {
                        statusLight.className = 'status-light warning';
                        statusText.textContent = 'è¯·æ›´æ–°å·¥å…·';
                        statusIndicator.title = 'å·¥å…·ç‰ˆæœ¬è¿‡æ—§ï¼Œè¯·æ›´æ–°';
                    } else {
                        statusLight.className = 'status-light connected';
                        statusText.textContent = 'å·¥å…·è¿è¡Œä¸­';
                        statusIndicator.title = 'å·¥å…·è¿æ¥æ­£å¸¸';
                    }
                    statusIndicator.style.cursor = 'default';
                    statusIndicator.onclick = null;
                    statusIndicator.classList.remove('disconnected-state');
                    // éšè—é®ç½©å±‚
                    if (connectionOverlay) {
                        connectionOverlay.classList.remove('show');
                    }
                })
                .catch(error => {
                    // è¿æ¥å¤±è´¥
                    disconnectedCount++;
                    statusLight.className = 'status-light disconnected';
                    statusText.textContent = 'å·¥å…·æœªè¿æ¥';
                    statusIndicator.title = 'å·¥å…·è¿æ¥å¤±è´¥ï¼Œç‚¹å‡»æŸ¥çœ‹å¸¸è§é—®é¢˜è§£ç­”';
                    statusIndicator.style.cursor = 'pointer';
                    statusIndicator.classList.add('disconnected-state');
                    statusIndicator.onclick = function () {
                        window.open(FAQ_URL, '_blank');
                    };

                    // å¦‚æœè¿ç»­å¤±è´¥è¶…è¿‡5ç§’ï¼ˆ5æ¬¡æ£€æŸ¥ï¼‰ä¸”ç”¨æˆ·æœªæ‰‹åŠ¨å…³é—­ï¼Œæ˜¾ç¤ºå…¨å±€é®ç½©
                    if (disconnectedCount >= 5 && !overlayDismissed && connectionOverlay && !connectionOverlay.classList.contains('show')) {
                        connectionOverlay.classList.add('show');
                    }
                });
        }

        // æ‰“å¼€FAQå¹¶å…³é—­é®ç½©å±‚
        function openFAQAndCloseOverlay() {
            window.open(FAQ_URL, '_blank');
            dismissOverlay();
        }

        // å…³é—­é®ç½©å±‚
        function dismissOverlay() {
            overlayDismissed = true;  // æ ‡è®°ç”¨æˆ·å·²æ‰‹åŠ¨å…³é—­
            const connectionOverlay = document.getElementById('connectionOverlay');
            if (connectionOverlay) {
                connectionOverlay.classList.remove('show');
            }
        }

        // å¯åŠ¨çŠ¶æ€æ£€æŸ¥
        function startStatusCheck() {
            // ç«‹å³æ‰§è¡Œä¸€æ¬¡æ£€æŸ¥
            checkToolStatus();
            // ç„¶åæ¯1ç§’æ£€æŸ¥ä¸€æ¬¡
            statusCheckInterval = setInterval(checkToolStatus, 1000);
        }

        // åœæ­¢çŠ¶æ€æ£€æŸ¥
        function stopStatusCheck() {
            if (statusCheckInterval) {
                clearInterval(statusCheckInterval);
                statusCheckInterval = null;
            }
        }

        function manual() {
            //è·å–channelSelectçš„å€¼
            var selectedChannel = document.getElementById('channelSelect').value;

            if (!selectedChannel) {
                swal({
                    title: "è¯·é€‰æ‹©ç™»å½•æ¸ é“",
                    icon: "warning",
                    button: "ç¡®å®š",
                });
                return;
            }

            swal({
                title: "æ­£åœ¨å¤„ç†",
                text: "æ­£åœ¨æ‰§è¡Œæ‰‹åŠ¨ç™»å½•ï¼Œè¯·ç¨å€™...å¦‚æœåœ¨æ­¤ç•Œé¢åœç•™è¿‡ä¹…ï¼Œè¯·å‚è€ƒæ•™ç¨‹æ–‡æ¡£->å¸¸è§é—®é¢˜è§£å†³æ–¹æ¡ˆé—®é¢˜18",
                icon: "info",
                buttons: false,
                closeOnClickOutside: false,
            });

            fetch(`/_idv-login/import?channel=${selectedChannel}&game_id=${game_id}`)
                .then(response => response.json())
                .then(data => {
                    swal.close();
                    if (data.success) {
                        swal({
                            title: "æ‰§è¡ŒæˆåŠŸ",
                            text: "ç™»å½•æ“ä½œå·²å®Œæˆ",
                            icon: "success",
                            button: "ç¡®å®š",
                        }).then(() => {
                            location.reload();
                        });
                    } else {
                        swal({
                            title: "æ‰§è¡Œå¤±è´¥",
                            text: "è¯·æ£€æŸ¥å·¥å…·æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯",
                            icon: "error",
                            button: "ç¡®å®š",
                        });
                    }
                });
        }
    </script>
</body>

</html>
